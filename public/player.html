<html>
  <head>
    <link href="./playlist.css" rel="stylesheet">
    <script src="https://www.youtube.com/iframe_api"></script>
  </head>  
  <body>
  
<!--     <iframe id="videoFrame" width="560" height="315" src="https://www.youtube-nocookie.com/embed/4JkIs37a2JE?autoplay=1&controls=1&disablekb=1&enablejsapi=1&iv_load_policy=3&origin=https%3A%2F%2Fsq-synced-videoplayer.glitch.me&start=0&playsinline=1&widgetid=1" 
            title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
     -->
    <div id="player">
      
    </div>
    <script>
       // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      
      let getId = (url) => {
        var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
        var match = url.match(regExp);
        return (match&&match[7].length==11)? match[7] : false;
      }
      let video = document.getElementById("videoFrame");
      // video.setAttribute('width', window.innerWidth);
      // video.setAttribute('height', window.innerHeight);
      const urlParams = new URLSearchParams(window.location.search);      
      // let url = 'https://www.youtube-nocookie.com/embed/' + getId(url_decode(urlParams.get('youtube'))) + '?autoplay=1&controls=1&disablekb=1&enablejsapi=1&iv_load_policy=3&origin=https%3A%2F%2Fsq-synced-videoplayer.glitch.me&start=0&playsinline=1&widgetid=1';
      
      
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: window.innerHeight,
          width: window.innerWidth,
          videoId: getId(decodeURIComponent(urlParams.get('youtube'))),
          playerVars: {
            'playsinline': 1,
            'autoplay': 1,
            'controls': 1,
            'disablekb': 1,
            'origin': 'https://sq-synced-videoplayer.glitch.me',
            'start': urlParams.get('start') || 0
          },
          events: {
            'onReady': (event) => {
              console.log('ready');
              event.target.mute();
              event.target.playVideo();
              setTimeout(() => {
                event.target.unMute();
              }, 3000)
              console.log('video should be playing?');
            },
            //'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      // function onPlayerReady(event) {
      //   event.target.playVideo();
      // }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      // var done = false;
      // function onPlayerStateChange(event) {
      //   if (event.data == YT.PlayerState.PLAYING && !done) {
      //     setTimeout(stopVideo, 6000);
      //     done = true;
      //   }
      // }
      // function stopVideo() {
      //   player.stopVideo();
      // }
    
    </script>
  </body>
</html>